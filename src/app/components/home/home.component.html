<p-table
    #dt1
    [value]="users"
    selectionMode="single"
    dataKey="id"
    [tableStyle]="{ 'min-width': '50rem' }"
    [rows]="5"
    [paginator]="true"
    stateStorage="session"
    stateKey="user-table-session"
    aria-label="Tabela de gestão de usuários">
    
    <ng-template pTemplate="caption">
        <div class="flex-container">
            <h3>Gestão de Usuários</h3>
            <div class="button-container">
                <p-button label="Adicionar usuário" class="btn-add" styleClass="p-button-outlined" [disabled]="!canCreateProfiles" (click)="openDialog('create')" [attr.aria-label]="'Botão para adicionar usuário'"></p-button>
                <p-button label="Editar perfis" class="btn-edit" styleClass="p-button-outlined" [disabled]="!canEditProfiles" (click)="openDialog('editProfile')" [attr.aria-label]="'Botão para editar perfis'"></p-button>
            </div>
        </div>
    </ng-template>
    
    <ng-template pTemplate="header">
        <tr>
            <th pSortableColumn="email" style="width:40%">
                Email <p-sortIcon field="email" />
            </th>
            <th pSortableColumn="permission.role" style="width:40%">
                Perfil <p-sortIcon field="permission.role" />
            </th>
            <th style="width:20%;">
                Ações
            </th>
        </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-user>
        <tr [pSelectableRow]="user" *ngIf="users.length > 0; else notUsers">
            <td>
                <span class="p-column-title">Nome</span>
                {{ user.email }}
            </td>
            <td>
                <span class="p-column-title">Perfil</span>
                {{ user.permission.role }}
            </td>
            <td style="text-align: start;">
                <span class="p-column-title">Ações</span>
                <button [disabled]="!canEditUserProfiles" pButton type="button" icon="pi pi-pencil" class="p-button mr-2" (click)="openDialog('edit', user)" [attr.aria-label]="'Botão para editar usuário ' + user.email"></button>
            </td>
        </tr>
    </ng-template>
    
    <ng-template pTemplate="emptymessage" #notUsers>
        <tr>
            <td colspan="3">Nenhum usuário encontrado.</td>
        </tr>
    </ng-template>
</p-table>

<div class="flex-mobile-container">
    <h2>Gestão de Usuários</h2>
    <div class="button-container">
        <p-button label="Adicionar usuário" class="btn-add" styleClass="p-button-outlined p-button-mobile" [disabled]="!canCreateProfiles" (click)="openDialog('create')" [attr.aria-label]="'Botão para adicionar usuário'"></p-button>
        <p-button label="Editar perfis" class="btn-edit" styleClass="p-button-outlined p-button-mobile" [disabled]="!canEditProfiles" (click)="openDialog('editProfile')" [attr.aria-label]="'Botão para editar perfis'"></p-button>
    </div>
</div>

<div class="card-container" *ngFor="let user of users">
    <p-card class="user-card" aria-label="Cartão de usuário">
        <ng-template pTemplate="content">
            <div class="infos">
                <div class="info-action">

                    <div class="user-info">
                        <h5><b>Email</b></h5>
                        <p> {{ user.email }}</p>
                    </div>

                    <div class="user-actions">
                        <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-secondary" (click)="openDialog('edit', user)" [attr.aria-label]="'Botão para editar usuário ' + user.email"></button>
                    </div>
                </div>
                <div class="user-info">
                    <h5><b>Perfil</b></h5>
                    <p> {{ user.permission.role }}</p>
                </div>
            </div>
        </ng-template>
    </p-card>
</div>

<app-adicionar-usuario
    [display]="isDialogCreateUserVisible"
    (closeDialog)="onDialogClose()"
    (saveDialog)="onDialogSave($event, 'create')"
    aria-label="Diálogo para adicionar usuário">
</app-adicionar-usuario>

<app-editar-usuario
    [user]="data"
    [display]="isDialogEditUserVisible"
    (closeDialog)="onDialogClose()"
    (saveDialog)="onDialogSave($event, 'edit')"
    aria-label="Diálogo para editar usuário">
</app-editar-usuario>

<app-editar-perfil
    [display]="isDialogVisible"
    (closeDialog)="onDialogClose()"
    (saveDialog)="onDialogSave($event, 'editProfile')"
    aria-label="Diálogo para editar perfil">
</app-editar-perfil>

<p-toast aria-label="Mensagens do sistema"></p-toast>
